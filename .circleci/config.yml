version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.8
    steps:

      # hugo持ってくる
      - run: mkdir $HOME/src
      - run: cd $HOME/src
      - run: rm -rf hugo
      - run: git clone https://github.com/gohugoio/hugo.git
      - run: cd hugo
      - run: go install
      - run: hugo new site TIL
      - run: cd TIL
      - run: git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
      - run: echo 'theme = "ananke"' >> config.toml 

      # blogリポジトリのデータを取得する
      - checkout

      - run: cp -r working_directory content


      # ビルドする
      - run: hugo

      # ユーザページサイトにPushする
      - deploy:
          command: git subtree push --prefix public origin gh-pages